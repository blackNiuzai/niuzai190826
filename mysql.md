## mysql的逻辑架构图

第一层：连接/线程处理、授权认证等

第二层：查询解析、分析、优化、缓存及内置函数、存储过程等

第三层： 存储引擎，负责数据的存储与提取，执行诸如“开始一个事务“、“根据主键提取一行”等，但存储引擎不会去解析SQL

### 优化与执行

mysql会解析查询，然后对其优化，包括重写查询，决定表的读取顺序以及选择合适的索引等。

对于select语句，解析查询前，会先检查查询缓存，如果命中则直接返回。



### 锁策略

所谓的锁策略，就是在锁的开销和数据的安全之间寻求平衡，这种平衡当然也会影响到性能。

锁分为共享锁和排他锁，也叫读锁和写锁



#### 表锁：

表锁是mysql中最基本的锁策略，并且是开销最小的策略



#### 行级锁：

行级锁可以最大程度地支持并发处理（同时也带来最大的锁开销）



#### innoDB处理死锁：

将持有最少行级排他锁的事务进行回滚



#### 事务日志：

事务日志可以提高事务效率， 使用事务日志时，存储引擎在修改表数据时只需要修改其内存拷贝，再把修改行为记录持久在硬盘的事务日志中，事务日志采用的是追加方式，在一小块磁盘区域内顺序I/O，然后内存中被修改的数据后台再慢慢刷回磁盘，这个日志也可以用于恢复来不及写回磁盘的数据。



#### MVCC

innoDB的MVCC是通过在每行记录后面保存两个隐藏的列实现，一个保存创建时间，一个保存过期时间或删除时间，这里的时间指的是系统版本号。



#### innoDB概览

innoDB采用MVCC来支持高并发，并且实现了四个标准的隔离级别，并且采用间隙锁策略防止幻读，使得innoDB不仅仅锁定查询涉及的行，还对索引中的间隙进行锁定，防止幻影行的插入。





## 性能剖析

#### show profile

1、set profiling = 1；

2、show profile for query #{n}

可以给出查询执行的步骤和每个步骤花费的时间



#### show status

1、flush status ; 将会话级别的计数器先置为0

2、执行查询语句；

3、show status;









