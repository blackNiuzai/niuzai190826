## redis 锁

redis有3种部署方式：

单机模式

master-slave + sentinel选举模式

redis cluster模式

使用redis做分布式锁的缺点在于：如果采用单机部署模式，会存在单点问题，只要redis故障了。加锁就不行了。

采用master-slave模式，加锁的时候只对一个节点加锁，即便通过sentinel做了高可用，但是如果master节点故障了，发生主从切换，此时就会有可能出现锁丢失的问题。

基于以上的考虑，其实redis的作者也考虑到这个问题，他提出了一个RedLock的算法，这个算法的意思大概是这样的：

假设redis的部署模式是redis cluster，总共有5个master节点，通过以下步骤获取一把锁：

获取当前时间戳，单位是毫秒

轮流尝试在每个master节点上创建锁，过期时间设置较短，一般就几十毫秒

尝试在大多数节点上建立一个锁，比如5个节点就要求是3个节点（n / 2 +1）

客户端计算建立好锁的时间，如果建立锁的时间小于超时时间，就算建立成功了

要是锁建立失败了，那么就依次删除这个锁

只要别人建立了一把分布式锁，你就得不断轮询去尝试获取锁

## 对于zk分布式锁而言:

zookeeper天生设计定位就是分布式协调，强一致性。锁的模型健壮、简单易用、适合做分布式锁。

如果获取不到锁，只需要添加一个监听器就可以了，不用一直轮询，性能消耗较小。


### redisson解决了什么问题
使锁可重入
使锁可以续命
实现了阻塞锁，使得业务上可以使用可以等待
删锁及续命等操作使用了lua脚本来保证其原子操作

### redis cluster
主要可以解决海量存储的问题





